<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quantum Gaming — Complaints & Suggestions</title>
<meta name="description" content="Complain or send feedback to Quantum Gaming — login with Discord" />

<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#6ee7b7; --danger:#fb7185;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; background:linear-gradient(180deg,#071022 0%, #071224 60%); color:#e6eef6}
  .wrap{max-width:980px; margin:28px auto; padding:18px; display:grid; gap:18px}
  header{display:flex; gap:12px; align-items:center; justify-content:space-between}
  .brand{display:flex; gap:12px; align-items:center}
  .logo{
    width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa);
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#042026;font-size:22px;box-shadow:0 6px 24px rgba(6,22,34,0.6);
  }
  h1{font-size:20px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .user-area{display:flex;gap:10px;align-items:center}
  .btn{
    background:linear-gradient(90deg,var(--accent),#60a5fa); color:#022; padding:10px 14px;border-radius:10px;border:0;font-weight:600;
    cursor:pointer; box-shadow:0 6px 18px rgba(6,22,34,0.45);
  }
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06); color:var(--accent);}
  .card{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px; border-radius:var(--radius); box-shadow:0 8px 30px rgba(2,6,23,0.6); overflow:hidden}
  .grid{display:grid; grid-template-columns: 1fr 360px; gap:18px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} .user-meta{order:2} }
  /* left column */
  .tabs{display:flex;gap:8px;margin-bottom:14px}
  .tab{flex:1;padding:12px;border-radius:12px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer;text-align:center}
  .tab.active{background:linear-gradient(90deg,var(--accent),#60a5fa); color:#022; font-weight:700}
  label.field{display:block;margin-bottom:10px;font-size:13px;color:var(--muted)}
  input[type=text], textarea, input[type=email]{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass); color:inherit}
  textarea{min-height:140px; resize:vertical}
  .field-row{display:flex;gap:8px}
  .field-row > *{flex:1}
  .meta-block{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .muted{color:var(--muted);font-size:13px}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  /* attachments */
  .drop{border:2px dashed rgba(255,255,255,0.04);padding:14px;border-radius:10px;text-align:center;cursor:pointer}
  .drop.drag{border-color:rgba(255,255,255,0.12);transform:scale(1.01)}
  .thumbs{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  .thumb{width:86px;height:86px;border-radius:10px;background:#071226;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.03)}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .thumb .rm{position:absolute;right:6px;top:6px;background:rgba(0,0,0,0.5);padding:4px;border-radius:6px;font-size:12px;cursor:pointer}
  .submit-row{display:flex;gap:10px;align-items:center;margin-top:12px}
  .progress{height:8px;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden;flex:1}
  .progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#60a5fa)}
  .small{font-size:12px;color:var(--muted)}
  /* right column user meta */
  .user-meta{padding:12px;display:flex;flex-direction:column;gap:12px}
  .user-row{display:flex;gap:12px;align-items:center}
  .avatar{width:68px;height:68px;border-radius:12px;background:#071226;display:flex;align-items:center;justify-content:center;font-weight:700}
  .field-label{font-size:12px;color:var(--muted)}
  .field-val{font-weight:600}
  /* captcha */
  .captcha{display:flex;gap:10px;align-items:center;margin-top:8px}
  .captcha .box{padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}
  /* footer */
  footer{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;padding-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">QG</div>
      <div>
        <h1>Quantum Gaming — Complaints & Feedback</h1>
        <p class="lead">Secure, quick and pretty complaints — login with Discord to submit.</p>
      </div>
    </div>

    <div class="user-area">
      <div id="loginStatus" class="muted">Not logged in</div>
      <button id="loginBtn" class="btn">Login with Discord</button>
    </div>
  </header>

  <main class="grid card">
    <section>
      <div class="tabs" role="tablist">
        <div class="tab active" data-type="complaint">Complaint</div>
        <div class="tab" data-type="suggestion">Suggestion / Feedback</div>
      </div>

      <div id="formArea" class="card" style="padding:16px">
        <form id="mainForm" autocomplete="off">
          <!-- Hidden honeypot for bots -->
          <input type="text" id="hp_field" name="hp_field" style="display:none" tabindex="-1" />

          <div class="meta-block">
            <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
              <div>
                <div class="field-label">Logged in as</div>
                <div id="displayName" style="font-weight:700">Guest</div>
                <div class="muted" id="displayEmail">—</div>
              </div>
              <div style="text-align:right">
                <div class="muted">Type</div>
                <div id="selectedType" style="font-weight:700">Complaint</div>
              </div>
            </div>
            <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <div>
                <label class="field">Username:
                  <input id="fieldUsername" type="text" readonly />
                </label>
              </div>
              <div>
                <label class="field">User ID:
                  <input id="fieldUserId" type="text" readonly />
                </label>
              </div>
              <div style="grid-column:1/3">
                <label class="field">Email:
                  <input id="fieldEmail" type="email" readonly />
                </label>
              </div>
            </div>
            <div class="hint">(Default details are locked to prevent impersonation.)</div>
          </div>

          <div style="margin-top:12px">
            <label class="field">Subject
              <input id="subject" type="text" placeholder="Short subject (eg: Match ban, toxic player, bug...)" maxlength="120" required/>
            </label>

            <label class="field" style="margin-top:8px">Description (optional)
              <textarea id="description" placeholder="Write details, steps to reproduce, time, usernames, etc."></textarea>
            </label>

            <div style="margin-top:8px" >
              <div class="field-label">Attachments (images/video/any file) — drag & drop or click to choose</div>
              <div id="dropzone" class="drop" tabindex="0">Drop files here or click to attach</div>
              <input id="fileInput" type="file" multiple style="display:none" />
              <div class="thumbs" id="thumbs"></div>
              <div class="hint">Max 8 files, 50 MB each (client-side check). Files are sent to webhook.</div>
            </div>

            <!-- CAPTCHA -->
            <div style="margin-top:12px">
              <div class="field-label">Anti-spam check</div>
              <div class="captcha">
                <div id="captchaBox" class="box">Loading...</div>
                <input id="captchaAnswer" type="text" placeholder="Answer" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass)" />
                <button type="button" id="refreshCaptcha" class="btn ghost">↻</button>
              </div>
              <div class="hint">Simple math captcha + local rate limit to reduce spam.</div>
            </div>

            <div class="submit-row">
              <div class="progress" title="upload progress"><i id="progressBar"></i></div>
              <button class="btn" id="submitBtn" type="submit">Send</button>
              <button type="button" id="clearBtn" class="btn ghost">Clear</button>
            </div>

            <div style="margin-top:8px"><span id="statusMsg" class="small"></span></div>
          </div>
        </form>
      </div>
    </section>

    <aside class="user-meta card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Your account</div>
        <div class="muted small">Locked by system</div>
      </div>

      <div class="user-row">
        <div id="avatar" class="avatar">QG</div>
        <div>
          <div class="field-label">Display name</div>
          <div id="u_name" class="field-val">Guest</div>
          <div class="muted small">Logged out</div>
        </div>
      </div>

      <div>
        <div class="field-label">Discord ID</div>
        <div id="u_id" class="field-val">—</div>
      </div>

      <div>
        <div class="field-label">Email</div>
        <div id="u_email" class="field-val">—</div>
      </div>

      <div style="margin-top:8px">
        <div class="field-label">Anti-spam status</div>
        <div id="spamStatus" class="muted small">No issues</div>
      </div>

      <div style="margin-top:8px">
        <div class="field-label">Quick tips</div>
        <ul class="muted small" style="padding-left:16px;margin:8px 0">
          <li>Provide evidence (time, screenshots).</li>
          <li>Keep subject short; description optional.</li>
          <li>Abuse = banned — misuse may be tracked.</li>
        </ul>
      </div>
    </aside>
  </main>

  <footer>
    <div class="muted">Quantum Gaming • Complaints system</div>
    <div class="muted">Built for mobile & desktop — single file</div>
  </footer>
</div>

<!-- forward.js (inline as requested) -->
<script>
/*
  forward.js inline
  - Uses client-side OAuth2 implicit flow to get an access_token (in URL hash)
  - Fetches /users/@me to populate locked fields
  - Sends FormData to a provided webhook (with files)
  - Client-side captcha + honeypot + rate-limit + anti-spam heuristics
*/

/* === CONFIG: set by user === */
const DISCORD_CLIENT_ID = '1450466176479006801';
const WEBHOOK_URL = 'https://discord.com/api/webhooks/1455556171506127014/1zgNGj3oI6sLbi0Ysr5gEUWCsBIMmGKyaWDeipJHGQQXIUeVQabqyw7o1oge5S9nh7Ov';
/* =========================== */

const SCOPES = 'identify%20email';
const REDIRECT_URI = location.origin + location.pathname; // make sure this URI is allowed in Discord app settings
const AUTH_URL = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${SCOPES}`;

const loginBtn = document.getElementById('loginBtn');
const loginStatus = document.getElementById('loginStatus');
const displayName = document.getElementById('displayName');
const displayEmail = document.getElementById('displayEmail');
const fieldUsername = document.getElementById('fieldUsername');
const fieldUserId = document.getElementById('fieldUserId');
const fieldEmail = document.getElementById('fieldEmail');
const avatarEl = document.getElementById('avatar');
const u_name = document.getElementById('u_name');
const u_id = document.getElementById('u_id');
const u_email = document.getElementById('u_email');
const spamStatus = document.getElementById('spamStatus');
const selectedType = document.getElementById('selectedType');
const tabs = document.querySelectorAll('.tab');

let userToken = null;
let user = null;
let currentType = 'Complaint'; // default
let captchaAnswer = null;
let files = []; // {file, previewUrl}
const MAX_FILES = 8;
const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50 MB

/* ---- OAuth handling (client-only) ---- */
function openDiscordLogin(){
  // open in same tab to allow redirect to this page with token in hash
  location.href = AUTH_URL;
}

function logout(){
  userToken = null;
  user = null;
  localStorage.removeItem('dg_token');
  updateUI();
}

/* Parse access token from URL hash if present */
function parseTokenFromHash(){
  if(location.hash && location.hash.includes('access_token')){
    const h = new URLSearchParams(location.hash.slice(1));
    const token = h.get('access_token');
    const expires_in = h.get('expires_in');
    if(token){
      localStorage.setItem('dg_token', JSON.stringify({ token, ts: Date.now(), expires_in: Number(expires_in)||3600 }));
      // clear hash
      history.replaceState(null, '', REDIRECT_URI + location.search);
      return token;
    }
  }
  const store = localStorage.getItem('dg_token');
  if(store){
    try{
      const obj = JSON.parse(store);
      // basic expiry check
      if(obj.expires_in && (Date.now() - obj.ts > (obj.expires_in * 1000))){
        localStorage.removeItem('dg_token');
        return null;
      }
      return obj.token;
    } catch(e){
      return null;
    }
  }
  return null;
}

/* Fetch user data */
async function fetchDiscordUser(token){
  try{
    const res = await fetch('https://discord.com/api/users/@me', {
      headers: { Authorization: 'Bearer ' + token }
    });
    if(!res.ok) throw new Error('Fetch user failed: ' + res.status);
    const data = await res.json();
    return data;
  } catch(err){
    console.warn('Discord API error', err);
    return null;
  }
}

/* Update UI based on login state */
function updateUI(){
  if(user){
    loginStatus.textContent = 'Logged in';
    loginBtn.textContent = 'Logout';
    loginBtn.classList.remove('btn');
    loginBtn.classList.add('btn');
    displayName.textContent = user.username + (user.discriminator ? ('#' + user.discriminator) : '');
    displayEmail.textContent = user.email || 'No email';
    fieldUsername.value = user.username;
    fieldUserId.value = user.id;
    fieldEmail.value = user.email || '';
    u_name.textContent = displayName.textContent;
    u_id.textContent = user.id;
    u_email.textContent = user.email || '—';
    // avatar
    if(user.avatar){
      const ext = user.avatar.startsWith('a_') ? 'gif' : 'png';
      avatarEl.innerHTML = `<img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.${ext}?size=128" style="width:100%;height:100%;object-fit:cover;border-radius:10px" alt="avatar">`;
    } else {
      avatarEl.textContent = user.username ? user.username.charAt(0).toUpperCase() : 'QG';
    }
  } else {
    loginStatus.textContent = 'Not logged in';
    loginBtn.textContent = 'Login with Discord';
    displayName.textContent = 'Guest';
    displayEmail.textContent = '—';
    fieldUsername.value = '';
    fieldUserId.value = '';
    fieldEmail.value = '';
    u_name.textContent = 'Guest';
    u_id.textContent = '—';
    u_email.textContent = '—';
    avatarEl.textContent = 'QG';
  }
}

/* On page load, check for token */
(async function initAuth(){
  userToken = parseTokenFromHash();
  if(userToken){
    // store and fetch user
    const u = await fetchDiscordUser(userToken);
    if(u){
      user = u;
      updateUI();
    } else {
      // network/CORS may fail, still keep token and ask user to allow or try in different browser
      user = null;
      updateUI();
    }
  } else {
    updateUI();
  }
})();

loginBtn.addEventListener('click', ()=>{
  if(user) {
    // logout
    logout();
  } else {
    openDiscordLogin();
  }
});

/* ---- Tabs ---- */
tabs.forEach(t=>{
  t.addEventListener('click', ()=> {
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    currentType = t.dataset.type === 'suggestion' ? 'Suggestion' : 'Complaint';
    selectedType.textContent = currentType;
  });
});

/* ---- Drag & drop + file input ---- */
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const thumbs = document.getElementById('thumbs');

dropzone.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', handleFiles);

['dragenter','dragover'].forEach(ev=>{
  dropzone.addEventListener(ev, (e)=>{
    e.preventDefault(); e.stopPropagation();
    dropzone.classList.add('drag');
  });
});
['dragleave','drop'].forEach(ev=>{
  dropzone.addEventListener(ev, (e)=>{
    e.preventDefault(); e.stopPropagation();
    dropzone.classList.remove('drag');
  });
});
dropzone.addEventListener('drop', (e)=>{
  const dt = e.dataTransfer;
  if(dt && dt.files) handleDroppedFiles(dt.files);
});

function handleDroppedFiles(fileList){
  const arr = Array.from(fileList);
  handleFilesList(arr);
}
function handleFiles(e){
  const list = Array.from(e.target.files || []);
  handleFilesList(list);
}
function handleFilesList(list){
  for(const f of list){
    if(files.length >= MAX_FILES){
      alert('Max files reached: ' + MAX_FILES);
      break;
    }
    if(f.size > MAX_FILE_SIZE){
      alert('File too large: ' + f.name);
      continue;
    }
    const previewUrl = URL.createObjectURL(f);
    files.push({ file: f, preview: previewUrl });
  }
  renderThumbs();
}
function renderThumbs(){
  thumbs.innerHTML = '';
  files.forEach((it, idx)=>{
    const div = document.createElement('div');
    div.className = 'thumb';
    const ext = it.file.type || '';
    if(ext.startsWith('image/')){
      div.innerHTML = `<img src="${it.preview}" alt="${it.file.name}"><div class="rm" data-i="${idx}">✕</div>`;
    } else {
      div.innerHTML = `<div style="padding:8px;text-align:center"><div style="font-size:12px">${it.file.name.length>18?it.file.name.slice(0,15)+'...':it.file.name}</div><div style="font-size:11px;color:var(--muted)">${(it.file.size/1024/1024).toFixed(1)} MB</div></div><div class="rm" data-i="${idx}">✕</div>`;
    }
    thumbs.appendChild(div);
  });
  document.querySelectorAll('.thumb .rm').forEach(el=>{
    el.addEventListener('click', (ev)=>{
      const i = Number(ev.currentTarget.dataset.i);
      URL.revokeObjectURL(files[i].preview);
      files.splice(i,1);
      renderThumbs();
    });
  });
}

/* ---- CAPTCHA ---- */
const captchaBox = document.getElementById('captchaBox');
const captchaAnswerInput = document.getElementById('captchaAnswer');
const refreshCaptcha = document.getElementById('refreshCaptcha');

function generateCaptcha(){
  // simple math captcha with small numbers, store expected answer in captchaAnswer var
  const a = Math.floor(Math.random()*8)+2;
  const b = Math.floor(Math.random()*8)+1;
  const ops = ['+','-','×'];
  const op = ops[Math.floor(Math.random()*ops.length)];
  let question, ans;
  if(op === '+'){ question = `${a} + ${b}`; ans = a + b; }
  else if(op === '-'){ question = `${a+b} - ${a}`; ans = b; }
  else { question = `${a} × ${b}`; ans = a * b; }
  captchaAnswer = String(ans);
  captchaBox.textContent = question + ' = ?';
  captchaAnswerInput.value = '';
}
refreshCaptcha.addEventListener('click', generateCaptcha);
generateCaptcha();

/* ---- Anti-spam & heuristics ---- */
function spamHeuristics(subject, description){
  // returns { ok: boolean, reason: string|null, score: number }
  let score = 0;
  const txt = (subject + ' ' + (description||'')).toLowerCase();
  // blacklisted quick words (example)
  const banned = ['buy followers', 'free nitro', 'hack', 'ddos', 'cheat'];
  for(const b of banned) if(txt.includes(b)) score += 40;
  // too short
  if((subject||'').trim().length < 3 && (description||'').trim().length < 10) score += 30;
  // many links?
  const links = (txt.match(/https?:\/\//g) || []).length;
  if(links > 3) score += 40;
  if(links > 0) score += 5;
  // repeated characters
  if(/(.)\1{10,}/.test(txt)) score += 30;
  // limit frequency per browser (localStorage)
  const key = 'qg_sub_history';
  const hist = JSON.parse(localStorage.getItem(key) || '[]').filter(t=> t + 1000*60*60*24 > Date.now()); // keep 24h
  if(hist.length > 10) score += 40;
  // final
  const ok = score < 50;
  return { ok, reason: ok ? null : 'Message flagged by anti-spam heuristics', score };
}

/* rate limiting */
function canSendNow(){
  const key = 'qg_send_times';
  const arr = JSON.parse(localStorage.getItem(key) || '[]').filter(t => t + 1000*60*60*24 > Date.now());
  // allow up to 6 submissions per 24 hours and at most 2 per 5 minutes
  const last5min = arr.filter(t => t + 1000*60*5 > Date.now()).length;
  if(arr.length >= 6) return { ok:false, reason:'Daily submission limit reached' };
  if(last5min >= 2) return { ok:false, reason:'Too many submissions recently (rate limit)'};
  return { ok:true };
}
function recordSend(){
  const key = 'qg_send_times';
  const arr = JSON.parse(localStorage.getItem(key) || '[]').filter(t => t + 1000*60*60*24 > Date.now());
  arr.push(Date.now());
  localStorage.setItem(key, JSON.stringify(arr));
}

/* ---- Form submit & send to webhook (XHR with progress) ---- */
const form = document.getElementById('mainForm');
const submitBtn = document.getElementById('submitBtn');
const clearBtn = document.getElementById('clearBtn');
const statusMsg = document.getElementById('statusMsg');
const progressBar = document.getElementById('progressBar');

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  statusMsg.textContent = '';
  // honeypot
  const hp = document.getElementById('hp_field').value;
  if(hp && hp.trim().length > 0){
    statusMsg.textContent = 'Bot detected (honeypot).';
    return;
  }
  // captcha
  const got = (captchaAnswerInput.value || '').trim();
  if(!got || got !== captchaAnswer){
    statusMsg.textContent = 'Captcha incorrect — please try again.';
    generateCaptcha();
    return;
  }
  // rate limit
  const rl = canSendNow();
  if(!rl.ok){
    statusMsg.textContent = rl.reason;
    return;
  }
  // gather
  const subject = document.getElementById('subject').value.trim();
  const description = document.getElementById('description').value.trim();
  if(!subject){
    statusMsg.textContent = 'Please add a short subject.';
    return;
  }
  // heuristics
  const heur = spamHeuristics(subject, description);
  spamStatus.textContent = heur.ok ? 'No issues' : heur.reason + ' (score ' + heur.score + ')';
  if(!heur.ok){
    statusMsg.textContent = heur.reason;
    return;
  }

  // prepare payload JSON for webhook
  const time = new Date().toISOString();
  const embed = {
    title: `${currentType}: ${subject}`,
    description: description || '(No description provided)',
    timestamp: time,
    fields: [
      { name: 'Username', value: fieldUsername.value || 'Guest', inline: true },
      { name: 'User ID', value: fieldUserId.value || '—', inline: true },
      { name: 'Email', value: fieldEmail.value || '—', inline: false },
      { name: 'Type', value: currentType, inline: true },
      { name: 'User Agent', value: navigator.userAgent.slice(0,180), inline: false }
    ],
    footer: { text: 'Quantum Gaming complaints' }
  };

  // Prepare FormData (payload_json + files)
  const fd = new FormData();
  const payload = { embeds: [embed], username: (user ? (user.username + (user.discriminator ? '#' + user.discriminator : '')) : 'WebUser') };
  fd.append('payload_json', JSON.stringify(payload));

  // append files as file0, file1...
  for(let i=0;i<files.length;i++){
    fd.append('file' + i, files[i].file, files[i].file.name);
  }

  // disable UI
  submitBtn.disabled = true;
  submitBtn.textContent = 'Sending...';
  statusMsg.textContent = 'Uploading...';

  // send with XHR so we can show progress
  const xhr = new XMLHttpRequest();
  xhr.open('POST', WEBHOOK_URL, true);
  xhr.upload.onprogress = function(e){
    if(e.lengthComputable){
      const pct = Math.round((e.loaded / e.total) * 100);
      progressBar.style.width = pct + '%';
    }
  };
  xhr.onload = function(){
    submitBtn.disabled = false;
    progressBar.style.width = '0%';
    if(xhr.status >= 200 && xhr.status < 300){
      statusMsg.textContent = 'Sent successfully — thank you!';
      // record
      recordSend();
      // reset some fields (but keep identity)
      document.getElementById('subject').value = '';
      document.getElementById('description').value = '';
      files.forEach(f => URL.revokeObjectURL(f.preview));
      files = [];
      renderThumbs();
      generateCaptcha();
    } else {
      statusMsg.textContent = 'Error sending: ' + xhr.status + ' — ' + xhr.statusText;
    }
    submitBtn.textContent = 'Send';
  };
  xhr.onerror = function(){
    submitBtn.disabled = false;
    progressBar.style.width = '0%';
    submitBtn.textContent = 'Send';
    statusMsg.textContent = 'Network error while sending. Try again later.';
  };
  xhr.send(fd);
});

clearBtn.addEventListener('click', ()=>{
  document.getElementById('subject').value = '';
  document.getElementById('description').value = '';
  files.forEach(f => URL.revokeObjectURL(f.preview));
  files = [];
  renderThumbs();
  statusMsg.textContent = 'Cleared.';
});

/* small UX: show login status and quick notes */
(function smallUX(){
  // show last sent count
  const key = 'qg_send_times';
  const arr = JSON.parse(localStorage.getItem(key) || '[]').filter(t => t + 1000*60*60*24 > Date.now());
  if(arr.length > 0) {
    document.getElementById('statusMsg').textContent = `You sent ${arr.length} submission(s) in last 24h.`;
  }
})();

</script>
</body>
</html>
