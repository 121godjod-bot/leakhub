<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Discord Complaint System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .box {
    width: 360px;
    background: #020617;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
  }

  h2 {
    text-align: center;
    margin-bottom: 15px;
  }

  button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 6px;
    background: #5865F2;
    color: white;
    font-size: 15px;
    cursor: pointer;
  }

  button:hover {
    opacity: 0.9;
  }

  input, textarea {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
    border-radius: 6px;
    border: none;
    background: #020617;
    color: white;
    border: 1px solid #334155;
  }

  textarea {
    resize: none;
    height: 90px;
  }

  .user {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .user img {
    width: 40px;
    border-radius: 50%;
  }

  .hidden {
    display: none;
  }
</style>
</head>

<body>

<div class="box">
  <h2>Complaint System</h2>

  <!-- LOGIN -->
  <div id="login">
    <button onclick="login()">Login with Discord</button>
  </div>

  <!-- USER + FORM -->
  <div id="app" class="hidden">
    <div class="user">
      <img id="avatar" />
      <div>
        <div id="username"></div>
        <small id="userid"></small>
      </div>
    </div>

    <input id="title" placeholder="Complaint title" />
    <textarea id="message" placeholder="Describe your complaint..."></textarea>

    <button onclick="sendComplaint()">Submit Complaint</button>
  </div>
</div>

<script>
const CLIENT_ID = "1450466176479006801";
const WEBHOOK_URL = "https://discord.com/api/webhooks/1455556171506127014/1zgNGj3oI6sLbi0Ysr5gEUWCsBIMmGKyaWDeipJHGQQXIUeVQabqyw7o1oge5S9nh7Ov";

function login() {
  const redirect = window.location.origin + "/";
  const url =
    `https://discord.com/oauth2/authorize` +
    `?client_id=${CLIENT_ID}` +
    `&response_type=token` +
    `&redirect_uri=${encodeURIComponent(redirect)}` +
    `&scope=identify`;

  window.location.href = url;
}

// Get token from URL
const hash = new URLSearchParams(window.location.hash.substring(1));
const token = hash.get("access_token");

if (token) {
  fetch("https://discord.com/api/users/@me", {
    headers: { Authorization: `Bearer ${token}` }
  })
  .then(r => r.json())
  .then(user => {
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");

    document.getElementById("username").textContent =
      `${user.username}#${user.discriminator}`;
    document.getElementById("userid").textContent = `ID: ${user.id}`;
    document.getElementById("avatar").src =
      `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
    
    window.discordUser = user;
  });
}

function sendComplaint() {
  const title = document.getElementById("title").value.trim();
  const msg = document.getElementById("message").value.trim();

  if (!title || !msg) {
    alert("Fill all fields");
    return;
  }

  const payload = {
    embeds: [{
      title: "ðŸš¨ New Complaint",
      color: 15158332,
      fields: [
        { name: "User", value: `${discordUser.username}#${discordUser.discriminator}` },
        { name: "User ID", value: discordUser.id },
        { name: "Title", value: title },
        { name: "Message", value: msg }
      ],
      footer: { text: "Complaint System V1" },
      timestamp: new Date()
    }]
  };

  fetch(WEBHOOK_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(() => {
    alert("Complaint sent successfully");
    document.getElementById("title").value = "";
    document.getElementById("message").value = "";
  })
  .catch(() => alert("Failed to send complaint"));
}
</script>

</body>
</html>
